P8105 Data Science I Homework 4
================
Olivia Wang (hw2852)
2022-11-16

In preparation for the problems below, we will load the following
libraries:

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
    ## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
    ## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
    ## ✔ tidyr   1.2.0      ✔ stringr 1.4.1 
    ## ✔ readr   2.1.2      ✔ forcats 0.5.2 
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

``` r
library(readxl)
library(dplyr)
```

# Problem 1

# Problem 2

Let us begin by importing the CSV file containing *Washington Post’s*
homicide data downloaded from GitHub, and applying the `clean_names`
function. We can then apply the `skim` function to generate a brief data
summary.

``` r
homicide_data = 
  read_csv("./homicide-data.csv") %>% 
  janitor::clean_names()
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
skimr::skim(homicide_data)
```

|                                                  |               |
|:-------------------------------------------------|:--------------|
| Name                                             | homicide_data |
| Number of rows                                   | 52179         |
| Number of columns                                | 12            |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |               |
| Column type frequency:                           |               |
| character                                        | 9             |
| numeric                                          | 3             |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |               |
| Group variables                                  | None          |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| uid           |         0 |             1 |   9 |  10 |     0 |    52179 |          0 |
| victim_last   |         0 |             1 |   1 |  20 |     0 |    12687 |          0 |
| victim_first  |         0 |             1 |   1 |  28 |     0 |    16640 |          0 |
| victim_race   |         0 |             1 |   5 |   8 |     0 |        6 |          0 |
| victim_age    |         0 |             1 |   1 |   7 |     0 |      102 |          0 |
| victim_sex    |         0 |             1 |   4 |   7 |     0 |        3 |          0 |
| city          |         0 |             1 |   5 |  14 |     0 |       50 |          0 |
| state         |         0 |             1 |   2 |   2 |     0 |       28 |          0 |
| disposition   |         0 |             1 |  14 |  21 |     0 |        3 |          0 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate |        mean |         sd |          p0 |         p25 |         p50 |         p75 |          p100 | hist  |
|:--------------|----------:|--------------:|------------:|-----------:|------------:|------------:|------------:|------------:|--------------:|:------|
| reported_date |         0 |             1 | 20130899.16 | 1123419.63 | 20070101.00 | 20100318.00 | 20121216.00 | 20150911.00 | 201511105\.00 | ▇▁▁▁▁ |
| lat           |        60 |             1 |       37.03 |       4.35 |       25.73 |       33.77 |       38.52 |       40.03 |         45.05 | ▁▅▅▇▅ |
| lon           |        60 |             1 |      -91.47 |      13.75 |     -122.51 |      -96.00 |      -87.71 |      -81.76 |        -71.01 | ▃▁▃▇▅ |

The *Washington Post’s* raw homicide data contains **52179 rows** and
**12 columns**. Each row corresponds to one homicide case, and the
following information regarding the homicide are found in each column:

-   Case ID code
-   Reported date
-   Victim identifiers (name, age, race and sex)
-   Location details (state, city, latitude and longitude)
-   Disposition

Based on the output generated above, we can see that there are no
missing values for all variables except for `latitude` and `longitude`.
The `latitude` variable has **60 missing values** and the `longitude`
variable has **60 missing values**.

## 2.1 City-Level Summaries of Homicide Data

#### *Total Homicides per City*

In the following code chunk, we create a new `city_state` variable
(e.g. “Baltimore, MD”) by joining the existing city and state variables
using the `paste` command. Since each row represents a unique homicide
case, we can determine the total number of homicides by counting the
number of observations per city-state pair. We will save the output as a
new data frame, to be used in further analysis.

``` r
homicide_data = homicide_data %>% 
  mutate(city_state = as.character(paste(city, state, sep = ", ")))

total_homicides =
  homicide_data %>% 
  group_by(city_state) %>% 
  summarize(n_obs = n()) %>% 
  arrange(desc(n_obs))
  
knitr::kable(total_homicides, col.names = c('City, State', 'Total Homicides (n)'))
```

| City, State        | Total Homicides (n) |
|:-------------------|--------------------:|
| Chicago, IL        |                5535 |
| Philadelphia, PA   |                3037 |
| Houston, TX        |                2942 |
| Baltimore, MD      |                2827 |
| Detroit, MI        |                2519 |
| Los Angeles, CA    |                2257 |
| St. Louis, MO      |                1677 |
| Dallas, TX         |                1567 |
| Memphis, TN        |                1514 |
| New Orleans, LA    |                1434 |
| Las Vegas, NV      |                1381 |
| Washington, DC     |                1345 |
| Indianapolis, IN   |                1322 |
| Kansas City, MO    |                1190 |
| Jacksonville, FL   |                1168 |
| Milwaukee, wI      |                1115 |
| Columbus, OH       |                1084 |
| Atlanta, GA        |                 973 |
| Oakland, CA        |                 947 |
| Phoenix, AZ        |                 914 |
| San Antonio, TX    |                 833 |
| Birmingham, AL     |                 800 |
| Nashville, TN      |                 767 |
| Miami, FL          |                 744 |
| Cincinnati, OH     |                 694 |
| Charlotte, NC      |                 687 |
| Oklahoma City, OK  |                 672 |
| San Francisco, CA  |                 663 |
| Pittsburgh, PA     |                 631 |
| New York, NY       |                 627 |
| Boston, MA         |                 614 |
| Tulsa, OK          |                 583 |
| Louisville, KY     |                 576 |
| Fort Worth, TX     |                 549 |
| Buffalo, NY        |                 521 |
| Fresno, CA         |                 487 |
| San Diego, CA      |                 461 |
| Stockton, CA       |                 444 |
| Richmond, VA       |                 429 |
| Baton Rouge, LA    |                 424 |
| Omaha, NE          |                 409 |
| Albuquerque, NM    |                 378 |
| Long Beach, CA     |                 378 |
| Sacramento, CA     |                 376 |
| Minneapolis, MN    |                 366 |
| Denver, CO         |                 312 |
| Durham, NC         |                 276 |
| San Bernardino, CA |                 275 |
| Savannah, GA       |                 246 |
| Tampa, FL          |                 208 |
| Tulsa, AL          |                   1 |

The output above reveals a something unexpected in these data: the
homicide data collected by *Washington Post* actually contains data from
**51** distinct cities, as opposed to the 50 originally indicated.
Further analysis of the data reveals that this discrepancy likely arose
due to the fact that there are two cities named Tulsa in different
states: one in Alabama and another in Oklahoma. Although the data from
Tulsa, AL seems to suggest that it may be a typographical error (i.e.,
Tulsa, AL was supposed to be entered as Tulsa, OK) since it reports to
have one single homicide over a decade, it is important for data
analysts to not make any assumptions about the data. Since the raw data
indicates that Tulsa, AL only reported one single homicide, and
therefore has minimal impact on our overall sample size, the data from
Tulsa, AL will be removed for further analysis.

``` r
total_homicides = total_homicides %>% 
  filter(n_obs > 1)
```

#### *Total Unsolved Homicides per City*

To determine the total number of unsolved homicides per city, we can
generate a new binary `unsolved_homicide` variable, which will take on a
value of 1 if the homicide is unsolved (i.e., disposition = “Closed
without arrest” or “Open/No arrest”) and 0 if the homicide is solved
(i.e., disposition = “Closed by arrest”). We will save the output as a
new data frame, to be used in further analysis.

``` r
homicide_data = homicide_data %>% 
  mutate(unsolved_homicide = ifelse(disposition == "Closed by arrest", 0, 1))

unsolved_homicides =
  homicide_data %>% 
  group_by(city_state) %>%
  filter(unsolved_homicide == 1) %>% 
  summarize(n_obs = n()) 

knitr::kable(unsolved_homicides, col.names = c('City, State', 'Unsolved Homicides (n)'))
```

| City, State        | Unsolved Homicides (n) |
|:-------------------|-----------------------:|
| Albuquerque, NM    |                    146 |
| Atlanta, GA        |                    373 |
| Baltimore, MD      |                   1825 |
| Baton Rouge, LA    |                    196 |
| Birmingham, AL     |                    347 |
| Boston, MA         |                    310 |
| Buffalo, NY        |                    319 |
| Charlotte, NC      |                    206 |
| Chicago, IL        |                   4073 |
| Cincinnati, OH     |                    309 |
| Columbus, OH       |                    575 |
| Dallas, TX         |                    754 |
| Denver, CO         |                    169 |
| Detroit, MI        |                   1482 |
| Durham, NC         |                    101 |
| Fort Worth, TX     |                    255 |
| Fresno, CA         |                    169 |
| Houston, TX        |                   1493 |
| Indianapolis, IN   |                    594 |
| Jacksonville, FL   |                    597 |
| Kansas City, MO    |                    486 |
| Las Vegas, NV      |                    572 |
| Long Beach, CA     |                    156 |
| Los Angeles, CA    |                   1106 |
| Louisville, KY     |                    261 |
| Memphis, TN        |                    483 |
| Miami, FL          |                    450 |
| Milwaukee, wI      |                    403 |
| Minneapolis, MN    |                    187 |
| Nashville, TN      |                    278 |
| New Orleans, LA    |                    930 |
| New York, NY       |                    243 |
| Oakland, CA        |                    508 |
| Oklahoma City, OK  |                    326 |
| Omaha, NE          |                    169 |
| Philadelphia, PA   |                   1360 |
| Phoenix, AZ        |                    504 |
| Pittsburgh, PA     |                    337 |
| Richmond, VA       |                    113 |
| Sacramento, CA     |                    139 |
| San Antonio, TX    |                    357 |
| San Bernardino, CA |                    170 |
| San Diego, CA      |                    175 |
| San Francisco, CA  |                    336 |
| Savannah, GA       |                    115 |
| St. Louis, MO      |                    905 |
| Stockton, CA       |                    266 |
| Tampa, FL          |                     95 |
| Tulsa, OK          |                    193 |
| Washington, DC     |                    589 |

## 2.2 City-Level Homicide Porportion Estimates & 95% CIs

#### *Proportion of Unsolved Homicides in Baltimore, MD*

Below we use the `prop.test` function to estimate the proportion of
homicides that are unsolved in Baltimore, MD. The arguments for the
`prop.test` function, x and n, were determined using the outputs from
Problem 2.1. Argument x, a vector of counts of successes, is the number
of unsolved homicides in Baltimore, MD, and n, a vector of counts of
trials, is the total number of homicides in Baltimore, MD.

The output generated from the `prop.test` function is then saved as an R
object. The `broom::tidy()` function was applied to tidy these data, and
finally the proportion estimate and the 95% confidence interval values
were pulled.

``` r
homicide_data %>% 
  filter(city_state == "Baltimore, MD")
```

    ## # A tibble: 2,827 × 14
    ##    uid   repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶ city  state   lat   lon
    ##    <chr>   <dbl> <chr>   <chr>   <chr>   <chr>   <chr>   <chr> <chr> <dbl> <dbl>
    ##  1 Bal-…  2.01e7 NELSON  LEON    Black   17      Male    Balt… MD     39.3 -76.7
    ##  2 Bal-…  2.01e7 GOLF    EDDIE   Black   26      Male    Balt… MD     39.3 -76.7
    ##  3 Bal-…  2.01e7 MACKEN… THOMAS… Black   21      Male    Balt… MD     39.4 -76.6
    ##  4 Bal-…  2.01e7 CANUPP  EDWARD… White   61      Male    Balt… MD     39.2 -76.6
    ##  5 Bal-…  2.01e7 CUNNIN… MICHAEL Black   46      Male    Balt… MD     39.4 -76.6
    ##  6 Bal-…  2.01e7 ALSTON  RAY WI… Black   27      Male    Balt… MD     39.3 -76.6
    ##  7 Bal-…  2.01e7 HENDER… YULE A… Black   21      Male    Balt… MD     39.3 -76.6
    ##  8 Bal-…  2.01e7 MCDOWE… MARCU   Black   16      Male    Balt… MD     39.3 -76.6
    ##  9 Bal-…  2.01e7 GARDNER RODNEY… Black   21      Male    Balt… MD     39.3 -76.6
    ## 10 Bal-…  2.01e7 BURNET… NELSENE Black   44      Female  Balt… MD     39.3 -76.7
    ## # … with 2,817 more rows, 3 more variables: disposition <chr>,
    ## #   city_state <chr>, unsolved_homicide <dbl>, and abbreviated variable names
    ## #   ¹​reported_date, ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age,
    ## #   ⁶​victim_sex

``` r
prop_test_homicide_baltimore = prop.test(x = 1825, n = 2827, conf.level = 0.95) 

prop_test_homicide_baltimore %>%
  broom::tidy() %>%
  select(estimate, starts_with("conf")) %>% 
  knitr::kable(col.names = c('Proportion Estimate', 'Lower 95% CI Limit', 'Upper 95% CI Limit'))
```

| Proportion Estimate | Lower 95% CI Limit | Upper 95% CI Limit |
|--------------------:|-------------------:|-------------------:|
|           0.6455607 |          0.6275625 |          0.6631599 |

#### *Proportion of Unsolved Homicides in All Cities*

We will now apply the `prop.test` function to all cities in the data
set. This process involves first creating a new
`homicide_data_to_prop_test` function, which applies the `prop.test`
function to any inputs. The `inner_join` function is applied to merge
the two data frames containing city-level total and unsolved homicide
counts to yield one data frame with both pieces of information. The
city-level homicide data will then be nested using the `nest` function
to generate list columns for city-level homicide counts, and the
`homicide_data_to_prop_test` function will be mapped to each tibble
using `purrr::map`.

``` r
homicide_data_to_prop_test = function(homicide_data) {
  prop.test(x = homicide_data$n_obs.y, n = homicide_data$n_obs.x, conf.level = 0.95) %>%
    broom::tidy() %>% 
    select(estimate, starts_with("conf"))
}

inner_join(total_homicides, unsolved_homicides, by = "city_state") %>%
  nest(data = n_obs.x:n_obs.y) %>%
  mutate(data = purrr::map(data, ~ homicide_data_to_prop_test(.x))) %>%
  unnest
```

    ## Warning: `cols` is now required when using unnest().
    ## Please use `cols = c(data)`

    ## # A tibble: 50 × 4
    ##    city_state       estimate conf.low conf.high
    ##    <chr>               <dbl>    <dbl>     <dbl>
    ##  1 Chicago, IL         0.736    0.724     0.747
    ##  2 Philadelphia, PA    0.448    0.430     0.466
    ##  3 Houston, TX         0.507    0.489     0.526
    ##  4 Baltimore, MD       0.646    0.628     0.663
    ##  5 Detroit, MI         0.588    0.569     0.608
    ##  6 Los Angeles, CA     0.490    0.469     0.511
    ##  7 St. Louis, MO       0.540    0.515     0.564
    ##  8 Dallas, TX          0.481    0.456     0.506
    ##  9 Memphis, TN         0.319    0.296     0.343
    ## 10 New Orleans, LA     0.649    0.623     0.673
    ## # … with 40 more rows

# Problem 3
